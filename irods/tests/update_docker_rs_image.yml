---
- name: test build image
  hosts: localhost
  tasks:
    - include_tasks: tasks/test_include_group_vars.yml
      vars:
        group: "{{ item.group }}"
        expected_value: "{{ item.expected_value }}"
      with_items:
        - group: extensionless_file
          expected_value: no extension
        - group: json_file
          expected_value: json
        - group: yaml_file
          expected_value: yaml
        - group: yml_file
          expected_value: yml

    - include_tasks: ../tasks/include_group_vars.yml
      vars:
        inventory_dir: ../tests
        group: dir

    - name: test include group vars from directory
      assert:
        that:
          - include_group_vars_json == 'json'
          - include_group_vars_none == 'no extension'
          - include_group_vars_yaml == 'yaml'
          - include_group_vars_yml == 'yml'

    - import_tasks: tasks/test_build_plugins.yml

    - name: test create command scripts staging directory
      stat:
        path: /tmp/cmd
      register: response
      failed_when: not response.stat.exists or not response.stat.isdir

    - name: test add calliope-ingest command script
      stat:
        path: /tmp/cmd/calliope-ingest
      register: response
      failed_when: not response.stat.exists

    - name: test add de-archive-data command script
      debug:
        msg: TODO implement

    - name: test add de-create-collection command script
      debug:
        msg: TODO implement

    - name: test add delete-scheduled-rule command script
      debug:
        msg: TODO implement

    - name: test add generateuuid command script
      debug:
        msg: TODO implement

    - name: test add rm-trash command script
      debug:
        msg: TODO implement

    - name: test add set-uuid command script
      debug:
        msg: TODO implement

    - name: test add sparcd-ingest command script
      debug:
        msg: TODO implement

    - debug:
        msg: TODO test import cyverse.irods-cfg

    - debug:
        msg: TODO test generate Diffie-Hellman parameters

    - name: test stage dynamic rule bases
      debug:
        msg: TODO implement

    - name: test stage static rule bases
      debug:
        msg: TODO implement

    - name: test copy .dockerignore
      debug:
        msg: TODO implement

    - name: test copy resource server docker scripts
      debug:
        msg: TODO implement
